---
name: Implement OKR Dashboard Real Data
status: open
created: 2025-10-01T02:51:14Z
updated: 2025-10-01T03:09:41Z
github: https://github.com/Montinou/stratixV2/issues/99
depends_on: [001, 002, 003, 004, 005]
parallel: false
conflicts_with: []
---

# Task: Implement OKR Dashboard Real Data

## Description
Replace mock data in the OKR Dashboard with real aggregate database queries using Neon PostgreSQL. Implement service layer to fetch dashboard statistics aggregating data from objectives, initiatives, activities, and profiles tables. This task depends on all previous page implementations since it aggregates their data.

## Acceptance Criteria
- [ ] Service file updated: `lib/services/analytics-service.ts` (add dashboard function)
- [ ] Page updated: `/app/tools/okr/page.tsx`
- [ ] Mock data array removed completely
- [ ] Empty state tested (displays when no data)
- [ ] Multi-tenant isolation verified (User A cannot see User B's data)
- [ ] Stats cards show real aggregate counts
- [ ] All data displays correctly with proper formatting
- [ ] Performance <2s with aggregate queries
- [ ] TypeScript build passes with no errors

## Technical Details

### Service Implementation
Add to existing `lib/services/analytics-service.ts`:

```typescript
export async function getOKRDashboardStats(organizationId: string) {
  // Aggregate queries across multiple tables:
  // - Objectives: total, active, completed, completion_rate
  // - Initiatives: total, active, blocked, completion_rate
  // - Activities: total, pending, overdue_count
  // - Team members: active_count from profiles
  // Return combined dashboard statistics object
}
```

### Database Tables & Queries
- `objectives`: COUNT(*), COUNT(CASE WHEN status = 'active'), AVG(progress)
- `initiatives`: COUNT(*), COUNT(CASE WHEN status = 'blocked'), AVG(progress)
- `activities`: COUNT(*), COUNT(CASE WHEN due_date < CURRENT_DATE AND status != 'completed')
- `profiles`: COUNT(DISTINCT user_id WHERE active = true)
- Filter all queries: `organization_id` (enforced by RLS)

### Aggregate Query Structure
```sql
-- Example aggregate structure
SELECT
  (SELECT COUNT(*) FROM objectives WHERE organization_id = $1) as objectives_total,
  (SELECT COUNT(*) FROM objectives WHERE organization_id = $1 AND status = 'active') as objectives_active,
  (SELECT AVG(progress) FROM objectives WHERE organization_id = $1) as objectives_avg_progress,
  -- ... similar for initiatives and activities
```

### Page Integration
Update `/app/tools/okr/page.tsx`:
- Replace mock dashboard stats with service call
- Update all stats cards to use `getOKRDashboardStats()`
- Handle empty state when no data exists
- Display percentage calculations correctly
- Maintain existing UI/UX design

## Dependencies
- [ ] Task 001 completed (RLS infrastructure)
- [ ] Task 002 completed (RLS verification)
- [ ] Task 003 completed (Objectives page real data)
- [ ] Task 004 completed (Initiatives page real data)
- [ ] Task 005 completed (Activities page real data)

## Effort Estimate
- **Size**: S
- **Hours**: 1 hour
- **Parallel**: false (must wait for other pages)

## Definition of Done
- [ ] Code implemented
- [ ] Multi-tenant tested with 2 organizations
- [ ] Empty state tested
- [ ] Aggregate calculations verified
- [ ] Performance benchmark met (<2s)
- [ ] Code reviewed
- [ ] TypeScript build passes with no errors
