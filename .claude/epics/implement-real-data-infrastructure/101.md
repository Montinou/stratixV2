---
name: Verify RLS Policies Active
status: open
created: 2025-10-01T02:51:14Z
updated: 2025-10-01T03:09:41Z
github: https://github.com/Montinou/stratixV2/issues/101
depends_on: [001]
parallel: false
conflicts_with: []
---

# Task: Verify RLS Policies Active

## Description

Verify that Row Level Security (RLS) policies are properly applied and active on all tenant-scoped tables in the database. This validation ensures that the database-level tenant isolation is functioning correctly before we start migrating pages to real data.

## Acceptance Criteria

- [ ] RLS enabled on all tenant-scoped tables (`profiles`, `objectives`, `initiatives`, `activities`)
- [ ] RLS function `get_current_tenant_id()` exists and is executable
- [ ] Manual SQL test confirms RLS policies enforce isolation
- [ ] Documentation created with verification queries
- [ ] Test results logged/documented

## Technical Details

**Verification Queries**:

1. **Check RLS Enabled**:
```sql
SELECT tablename, rowsecurity
FROM pg_tables
WHERE schemaname = 'public'
  AND tablename IN ('profiles', 'objectives', 'initiatives', 'activities');

-- Expected: All tables show rowsecurity = true
```

2. **Check RLS Policies Exist**:
```sql
SELECT schemaname, tablename, policyname, permissive, roles, cmd
FROM pg_policies
WHERE schemaname = 'public'
  AND tablename IN ('profiles', 'objectives', 'initiatives', 'activities');

-- Expected: Multiple policies per table (SELECT, INSERT, UPDATE, DELETE)
```

3. **Test RLS Function**:
```sql
-- Set context
SELECT set_config('app.current_user_id', 'test-user-id', false);

-- Test function execution
SELECT public.get_current_tenant_id();

-- Expected: Returns a tenant_id (or null if user has no profile)
```

4. **Test Tenant Isolation** (manual test with 2 users):
```sql
-- As User A (set context)
SELECT set_config('app.current_user_id', 'user-a-id', false);
SELECT * FROM objectives;
-- Should only see User A's tenant data

-- As User B (set different context)
SELECT set_config('app.current_user_id', 'user-b-id', false);
SELECT * FROM objectives;
-- Should only see User B's tenant data
```

**Files to Create**:
- `docs/rls-verification.md` - Verification results and queries

**Key Considerations**:
- This is a validation task, not implementation
- Confirms existing RLS infrastructure is working
- Documents how to verify RLS in the future

## Dependencies

**External**:
- [ ] NeonDB database accessible
- [ ] Test users/data exist (or create test data)

**Internal**:
- [ ] Task 001 completed (RLS client infrastructure exists)
- [ ] RLS policies already applied (from previous work)

## Effort Estimate

- **Size**: XS
- **Hours**: 0.5 hours
- **Parallel**: false (must wait for Task 001)

## Definition of Done

- [ ] All verification queries executed successfully
- [ ] Documentation created showing RLS is active
- [ ] Multi-tenant isolation confirmed with test data
- [ ] Results documented in `docs/rls-verification.md`
- [ ] Any issues found are documented and resolved
