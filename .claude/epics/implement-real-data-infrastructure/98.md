---
name: Implement Activities Page Real Data
status: open
created: 2025-10-01T02:51:14Z
updated: 2025-10-01T03:09:41Z
github: https://github.com/Montinou/stratixV2/issues/98
depends_on: [001, 002]
parallel: true
conflicts_with: []
---

# Task: Implement Activities Page Real Data

## Description
Replace mock data in the Activities page with real database queries using Neon PostgreSQL. Implement service layer to fetch activities with initiative relationships, proper multi-tenant isolation, calculate overdue tasks, display empty states when no data exists, and show real-time statistics in the stats cards.

## Acceptance Criteria
- [ ] Service file created: `lib/services/activities-service.ts`
- [ ] Page updated: `/app/tools/activities/page.tsx`
- [ ] Mock data array removed completely
- [ ] Empty state tested (displays when no data)
- [ ] Multi-tenant isolation verified (User A cannot see User B's data)
- [ ] Stats cards show real counts (including overdue calculation)
- [ ] All data displays correctly with proper formatting
- [ ] Performance <2s with 100+ records
- [ ] TypeScript build passes with no errors

## Technical Details

### Service Implementation
Create `lib/services/activities-service.ts` with the following functions:

```typescript
export async function getActivitiesForPage(organizationId: string) {
  // Query activities table with INNER JOIN to initiatives
  // LEFT JOIN to profiles for assignee information
  // Include: id, title, description, status, initiative_title, assignee_name, priority, due_date
  // Filter by organization_id for RLS
  // Order by priority DESC, due_date ASC
}

export async function getActivityStats(organizationId: string) {
  // Return aggregate stats: total, pending, in_progress, completed, overdue
  // Calculate overdue: status != 'completed' AND due_date < CURRENT_DATE
  // Calculate from status and due_date fields
}
```

### Database Tables
- Primary: `activities`
- Join: `initiatives` (INNER JOIN for initiative_title)
- Join: `profiles` (LEFT JOIN for assignee_name)
- Filter: `organization_id` (enforced by RLS)

### Overdue Calculation Logic
```sql
-- Overdue calculation
WHERE status != 'completed'
  AND due_date < CURRENT_DATE
  AND organization_id = $1
```

### Page Integration
Update `/app/tools/activities/page.tsx`:
- Replace `mockActivities` array with service call
- Update stats cards to use `getActivityStats()`
- Handle empty state with proper messaging
- Display initiative relationships correctly
- Highlight overdue activities visually
- Maintain existing UI/UX design

## Dependencies
- [ ] Task 001 completed (RLS infrastructure)
- [ ] Task 002 completed (RLS verification)

## Effort Estimate
- **Size**: S
- **Hours**: 2 hours
- **Parallel**: true (independent after foundation)

## Definition of Done
- [ ] Code implemented
- [ ] Multi-tenant tested with 2 organizations
- [ ] Empty state tested
- [ ] Overdue calculation verified
- [ ] Performance benchmark met (<2s with 100+ records)
- [ ] Code reviewed
- [ ] TypeScript build passes with no errors
