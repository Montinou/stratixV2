---
name: Migrate companies page to API endpoints
status: open
created: 2025-09-25T04:10:26Z
updated: 2025-09-25T04:10:26Z
github: [Will be updated when synced to GitHub]
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Migrate companies page to API endpoints

## Description
Update `/app/companies/page.tsx` to use `/api/companies` endpoints instead of direct Supabase client calls. This is critical administrative functionality for company management.

## Acceptance Criteria
- [ ] Companies page loads and displays real company data (not mock)
- [ ] Company list view works with proper role-based filtering
- [ ] Create company functionality works through API
- [ ] Edit company functionality works through API  
- [ ] Delete company functionality works through API
- [ ] Role-based access control enforced (corporativo level required)
- [ ] Company settings and configurations load correctly

## Technical Details
**Implementation Approach:**
- Replace `supabase.from('companies')` with `fetch('/api/companies')`
- Implement role-based UI restrictions (corporativo access only)
- Update CRUD operations to use API endpoints
- Maintain existing company management workflows

**Key Considerations:**
- Companies API uses enhanced response format: `{ success: boolean, data?: T, error?: string }`
- Only corporativo role can access company management
- API handles company hierarchy and department relationships
- Company settings stored as JSON objects in database

**Code Locations:**
- Primary: `/app/companies/page.tsx`
- Related: Company management components and forms

## Dependencies
- [ ] `/api/companies` endpoints (already exist and tested)
- [ ] Role-based authorization system (already operational)
- [ ] Company schema in NeonDB (already established)

## Effort Estimate
- Size: M
- Hours: 6-8 hours
- Parallel: true (independent of other page migrations)

## Definition of Done
- [ ] Company management page fully functional via API endpoints
- [ ] Role-based access control working correctly
- [ ] All CRUD operations tested and working
- [ ] TypeScript compilation successful with no errors
- [ ] Company data integrity maintained